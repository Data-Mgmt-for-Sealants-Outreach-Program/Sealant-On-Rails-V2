<!DOCTYPE html>
<html>
<head>
    <title>Screening</title>
    <style>
        /* Styling for the table */
        table {
            border-collapse: collapse;
            width: 80%;
            margin: 20px auto;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            padding: 8px;
            text-align: center;
        }

        /* Styling for the buttons */
        .button {
            background-color: white ;
            color: black;
            border: none;
            cursor: pointer;
        }

        /* Styling for the popup container (initially hidden) */
        .popup-container {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
        }

        /* Styling for the popup box */
        .popup-box {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }

            /* CSS for the smaller popup */
    .popup-box-small {
        background-color: #fff;
        padding: 10px; /* Smaller padding */
        border-radius: 5px;
        text-align: left; /* Align options vertically */
        max-height: 300px; /* Maximum height to enable scrolling if many options */
        overflow-y: auto; /* Enable vertical scrolling if needed */
    }
    /* Display radio buttons and labels vertically */
    .popup-box-small label {
        display: block;
    }

    /* Add some spacing between radio buttons */
    .popup-box-small input[type="radio"] {
        margin-right: 5px;
    }

/* You can further adjust the width, height, and styling as per your requirements */

    </style>
</head>
<body>

    <h1>Screening</h1>
    <table>
      <tr>
        <!-- Create buttons for each tooth -->
        <% (1..3).each do |tooth_number| %>
          <td><button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')"><%= tooth_number %></button></td>
        <% end %>
        <% (4..13).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= tooth_number %><br><%= ('A'..'J').to_a[tooth_number - 4] %>
            </button>
          </td>
        <% end %>
        <% (14..16).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= tooth_number %>
            </button>
          </td>
        <% end %>
      </tr>
      <tr>
        <!-- Create buttons for each tooth -->
        <% (32).downto(30).each do |tooth_number| %>
          <td><button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')"><%= tooth_number %></button></td>
        <% end %>
        <% (29).downto(20).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= ('T'.ord).downto('K'.ord).map(&:chr)[29 - tooth_number] %> <br> <%= tooth_number %>
            </button>
          </td>
        <% end %>
        <% (19).downto(17).each do |tooth_number| %>
          <td>
            <button class="button" data-popup="popup<%= tooth_number %>" onclick="openPopup('popup<%= tooth_number %>')">
              <%= tooth_number %>
            </button>
          </td>
        <% end %>
      </tr>
    </table>
    <% (1..32).each do |tooth_number| %>
      <div class="popup-container" id="popup<%= tooth_number %>">
        <div class="popup-box-small">
          <% radio_options = [
            { value: "D", label: "D - Decay" },
            { value: "F", label: "F - Filled" },
            { value: "M", label: "M - Missing" },
            { value: "S", label: "S - Sealant Present" },
            { value: "PS", label: "PS - Prescribe Present" },
            { value: "RS", label: "RS - Recommended Reseal" },
            { value: "no mark", label: "No Treatment (No Mark)" }
          ] %>
          <% radio_options.each do |option| %>
            <label>
              <input type="radio" name="radio<%= tooth_number %>" value="<%= option[:value] %>">
              <%= option[:label] %>
            </label>
          <% end %>
          <button onclick="closePopup('<%= tooth_number %>','popup<%= tooth_number %>')">Close</button>
        </div>
      </div>
    <% end %>
<br/>
<br/>
    <p>Untreated Cavities:  <span contenteditable="true"></span>
    <input type="text" name="1st-molars" id="untreated-cavity"><br>
    </p>
    <p>Caries Experience:  <span contenteditable="true"></span>
    <input type="text" name="1st-molars" id="caries-experience"></textarea><br>
    </p>
    <p>Sealants Present:  <span contenteditable="true"></span>
    <input type="text" name="1st-molars" id="sealant-present"></textarea><br>
    </p>
    <p>Referred for treatment:  <span contenteditable="true"></span>
    <input type="text" name="1st-molars" id="referred-for-treatment"></textarea><br>
    </p>

    <p>Decayed or Filled Surfaces:<span contenteditable="false"></span>

  <div class="decayed-filled-surfaces-fields">
    <div class="decayed-filled-surfaces-field">
      <label for="1st-molars">1st Molars:</label>
      <input type="text" name="1st-molars" id="1st-molars">
    </div>
  </div>
<br/>
    <%= link_to "Next", preventive_services_path %>
    <script>

///Code for Screening
        const selectedOptions = {}; // Object to hold selected options for each popup

        // Function to open the popup and set selected option
        function openPopup(popupId) {
            // console.log(selected)
            const popup = document.getElementById(popupId);

            // Show the popup
            if (popup) {
                popup.style.display = 'block';
            }
        }

        // Function to save the selected option and close the popup
        function closePopup(Id,popupId) {
            const radioOptions = document.querySelectorAll(`input[name="radio${Id}"]`);


            // Find the selected option for the specific popup
            radioOptions.forEach(option => {
                if (option.checked) {
                    selectedOptions[popupId] = option.value; // Save the selected option
                }
            });
            console.log(selectedOptions)

            // Do something with the selected option (e.g., send it to the server)
            console.log(`Selected Option for ${popupId}: ${selectedOptions[popupId]}`);

            // Close the popup
            closePopupActual(popupId);
        }

        // Function to close the popup
        function closePopupActual(popupId) {
            const popup = document.getElementById(popupId);
            if (popup) {
                popup.style.display = 'none';
            }
        }

        // JavaScript to capture the selected date and store it in the hidden field
        document.getElementById('date').addEventListener('change', function () {
            document.getElementById('selectedDate').value = this.value;
        });

    </script>
</body>
</html>