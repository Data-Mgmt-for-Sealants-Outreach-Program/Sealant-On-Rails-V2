<p style="color: green"><%= notice %></p>

<h1>Patient Details</h1>

<%= button_to "New patient detail", new_patient_detail_path, method: :get, class: "btn btn-primary" %>
<br/>
<%= link_to 'Export All Patient Data', export_child_level_details_with_patient_info_path, class: 'btn btn-primary' %>

<br/>
<br/>
<input type="text" id="searchInput" placeholder="Search for a patient id...">
<br/>
<br/>

<div id="patient_details">

    <table class="table table-striped table-bordered table-hover">
      <thead class="thead-dark">
        <tr>
        <th style="text-align: center;">Patient id</th>
        <th style="text-align: center;">Program Name</th>
        <th style="text-align: center;">School Name</th>
        <th style="text-align: center;">Link</th>
        </tr>
      </thead>
      <tbody>
        <% @patient_details.each do |patient_detail| %>
          <tr>
          <td style="text-align: center;"><%= patient_detail.PatientId %></td>
            <td style="text-align: center;"><%= patient_detail.ProgramName %></td>
            <td style="text-align: center;"><%= patient_detail.SchoolName %></td>
            <td><%= button_to "Show this Patient's Details", patient_detail , method: :get, class: "btn btn-info" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
</div>

<script>
    document.getElementById("searchInput").addEventListener("input", function() {
        const searchValue = this.value;
        const rows = document.querySelectorAll('#patient_details tbody tr');

        rows.forEach(row => {
            const patientIdCell = row.querySelector('td:nth-child(1)'); // Assuming the Patient ID is in the first column
            const patientId = patientIdCell.textContent.trim();

            if (patientId.includes(searchValue)) {
                row.style.display = "";
            } else {
                row.style.display = "none";
            }
        });
    });
</script>

